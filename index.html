<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>导出你电脑上安装的软件名</title>
    <link rel="stylesheet" href="./bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <style>
      .template { display: none; }
      .display { display: block; }
    </style>
  </head>
  <body>
    <button id="regeditBtn">记录名字</button>
    <button id="saveBtn">保存修改</button>
    <button id="addBtn">添加其他</button>
    <button id="exportBtn">导出全部</button>
    <table id="regedit" class="table table-hover table-bordered">
      <caption class="tips">备份你电脑上所有安装软件名字，以及导出。（请等待进程流畅后再点击记录名字按钮，否则会有遗漏。）</caption>
      <thead>
        <tr>
          <th>#</th>
          <th>软件名</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody class="tbody">
        <tr class="template">
            <th class="num">0</th>
            <td class="product">火绒</td>
            <td class="mod">
              <a href="javascript:;">删除</a>
            </td>
        </tr>
      </tbody>
    </table>
    
    <!-- You can also require other files to run in this process -->
    <script src="./renderer.js"></script>
    <script>
      const electron = window.electron

      const ipcRenderer = window.electron.ipcRenderer;
      
      const regeditBtn = document.getElementById('regeditBtn')

      const $regedit = $('#regedit')
      const $tips = $('.tips')
      const $tbody = $('.tbody')
      
      regeditBtn.addEventListener('click', () => {
        $tbody.children('tr.block').remove()
        ipcRenderer.send('getRegedit', 'ping')
      })

      function replaceTipsHTML(content) {
        $tips.html(content)
      }
      
      ipcRenderer.on('getRegedit-reply', (event, arg) => { // 
        let product_length = Object.keys(arg).length

        replaceTipsHTML(`本次已读取到${product_length}个软件名字。`)

        for (let i = 0 ; i < product_length ; i++) {
          let template = $('.template').clone()
          template.children('.num').html(i)
          template.children('.product').html(arg[i])
          template.removeClass('template').addClass('block')
          $tbody.append(template)
        }
      })
    </script>
  </body>
</html>
